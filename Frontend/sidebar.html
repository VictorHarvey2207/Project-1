<style>
    #sidebar {
        position: fixed;
        left: 0;
        top: 0;
        height: 100vh;
        width: 260px;
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        z-index: 50;
    }
    #sidebar.show {
        transform: translateX(0);
    }
</style>

<!-- Sidebar -->
<aside id="sidebar" class="bg-white dark:bg-[#1a2634] border-r border-slate-200 dark:border-slate-700 flex flex-col shadow-lg">
    <div class="h-16 flex items-center gap-3 px-6 border-b border-slate-100 dark:border-slate-700 shrink-0">
        <div class="w-8 h-8 rounded-lg bg-primary text-white flex items-center justify-center shadow-md shadow-primary/30">
            <span class="material-symbols-outlined text-[20px]">hotel_class</span>
        </div>
        <span class="font-bold text-lg tracking-tight text-slate-800 dark:text-white">HotelPro</span>
    </div>
    <div class="flex-1 overflow-y-auto py-6 px-3 flex flex-col gap-1.5">
        <div class="px-3 mb-2 text-xs font-semibold text-slate-400 uppercase tracking-wider">Chức năng chính</div>
        <a href="Dashboard.html" class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-700/50 hover:text-primary dark:hover:text-primary transition-all group text-left">
            <span class="material-symbols-outlined text-[22px] group-hover:scale-110 transition-transform text-slate-400 group-hover:text-primary">dashboard</span>
            <span class="text-sm font-medium">Tổng quan</span>
        </a>
        <a href="RoomManagementWidget.html" class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-700/50 hover:text-primary dark:hover:text-primary transition-all group text-left active-link" data-page="room">
            <span class="material-symbols-outlined text-[22px] group-hover:scale-110 transition-transform text-slate-400 group-hover:text-primary">bedroom_parent</span>
            <span class="text-sm font-medium">Quản lý phòng</span>
        </a>
        <a href="CustomerManagementWidget.html" class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-700/50 hover:text-primary dark:hover:text-primary transition-all group text-left active-link" data-page="customer">
            <span class="material-symbols-outlined text-[22px] group-hover:scale-110 transition-transform text-slate-400 group-hover:text-primary">group</span>
            <span class="text-sm font-medium">Quản lý khách hàng</span>
        </a>
        <a href="ReservationManagementWidget.html" class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-700/50 hover:text-primary dark:hover:text-primary transition-all group text-left active-link" data-page="reservation">
            <span class="material-symbols-outlined text-[22px] group-hover:scale-110 transition-transform text-slate-400 group-hover:text-primary">calendar_month</span>
            <span class="text-sm font-medium">Đặt / Nhận phòng</span>
        </a>
        <a href="CheckOutWidget.html" class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-700/50 hover:text-primary dark:hover:text-primary transition-all group text-left active-link" data-page="checkout">
            <span class="material-symbols-outlined text-[22px] group-hover:scale-110 transition-transform text-slate-400 group-hover:text-primary transform rotate-180">login</span>
            <span class="text-sm font-medium">Trả phòng</span>
        </a>
        <div class="h-px bg-slate-100 dark:bg-slate-700 my-2 mx-3"></div>
        <div class="px-3 mb-2 text-xs font-semibold text-slate-400 uppercase tracking-wider">Quản lý</div>
        <a href="ServiceManagementWidget.html" class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-700/50 hover:text-primary dark:hover:text-primary transition-all group text-left active-link" data-page="service">
            <span class="material-symbols-outlined text-[22px] group-hover:scale-110 transition-transform text-slate-400 group-hover:text-primary">room_service</span>
            <span class="text-sm font-medium">Quản lý dịch vụ</span>
        </a>
        <a href="InvoiceManagementWidget.html" class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-700/50 hover:text-primary dark:hover:text-primary transition-all group text-left active-link" data-page="invoice">
            <span class="material-symbols-outlined text-[22px] group-hover:scale-110 transition-transform text-slate-400 group-hover:text-primary">receipt_long</span>
            <span class="text-sm font-medium">Quản lý hóa đơn</span>
        </a>
        <button class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-700/50 hover:text-primary dark:hover:text-primary transition-all group text-left">
            <span class="material-symbols-outlined text-[22px] group-hover:scale-110 transition-transform text-slate-400 group-hover:text-primary">analytics</span>
            <span class="text-sm font-medium">Thống kê</span>
        </button>
        <a href="AdvanceFeaturesWidget.html" class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-700/50 hover:text-primary dark:hover:text-primary transition-all group text-left" data-page="advanced">
            <span class="material-symbols-outlined text-[22px] group-hover:scale-110 transition-transform text-slate-400 group-hover:text-primary">settings</span>
            <span class="text-sm font-medium">Chức năng nâng cao</span>
        </a>
    </div>
    <div class="p-4 border-t border-slate-100 dark:border-slate-700/50 bg-slate-50 dark:bg-[#151f2b]">
        <button class="w-full flex items-center gap-3 px-3 py-2 rounded-lg text-slate-500 hover:bg-white hover:text-red-600 hover:shadow-sm dark:text-slate-400 dark:hover:bg-slate-700 dark:hover:text-red-400 transition-all border border-transparent hover:border-slate-200 dark:hover:border-slate-600">
            <span class="material-symbols-outlined text-[22px]">logout</span>
            <span class="text-sm font-medium">Thoát ứng dụng</span>
        </button>
    </div>
</aside>

<script>
    // Store the handler globally to allow removal
    let mouseMoveHandler = null;
    
    function initSidebar(currentPage) {
        const sidebar = document.getElementById('sidebar');
        if (!sidebar) {
            console.error('[Sidebar] Sidebar element not found');
            return;
        }

        // Highlight current page
        if (currentPage) {
            const links = document.querySelectorAll('[data-page]');
            console.log('[Sidebar] Found', links.length, 'data-page links');
            links.forEach(link => {
                if (link.dataset.page === currentPage) {
                    console.log('[Sidebar] Highlighting page:', currentPage);
                    link.classList.add('bg-primary/5', 'text-primary', 'border', 'border-primary/10');
                    link.classList.remove('text-slate-600', 'dark:text-slate-400', 'hover:bg-slate-50', 'dark:hover:bg-slate-700/50');
                    const icon = link.querySelector('.material-symbols-outlined');
                    if (icon) icon.classList.add('filled');
                }
            });
        }

        // Add click handlers to anchor links with explicit navigation
        const navLinks = sidebar.querySelectorAll('a[href$=".html"]');
        navLinks.forEach((link) => {
            link.addEventListener('click', (e) => {
                const href = link.getAttribute('href');
                const dataPage = link.dataset.page;
                console.log('[Sidebar] Clicked link:', href, 'data-page:', dataPage);
                // Explicitly navigate
                setTimeout(() => {
                    window.location.href = href;
                }, 0);
            });
        });

        // Remove old listener if exists
        if (mouseMoveHandler) {
            document.removeEventListener('mousemove', mouseMoveHandler);
        }

        // Create new handler
        mouseMoveHandler = (e) => {
            const mouseX = e.clientX;
            if (mouseX < 30) {
                sidebar.classList.add('show');
            } else if (mouseX > 280) {
                sidebar.classList.remove('show');
            }
        };

        // Add new listener
        document.addEventListener('mousemove', mouseMoveHandler);
    }
</script>
